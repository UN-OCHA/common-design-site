_meta:
  version: '1.0'
  entity_type: node
  uuid: 0cb87926-14f0-4c4f-9fc8-aadfec215a6a
  bundle: basic
  default_langcode: en
  depends:
    86b55c06-221e-4d01-ba0b-e0b1f31a5287: user
default:
  revision_uid:
    -
      entity: 86b55c06-221e-4d01-ba0b-e0b1f31a5287
  status:
    -
      value: true
  uid:
    -
      entity: 86b55c06-221e-4d01-ba0b-e0b1f31a5287
  title:
    -
      value: 'Common Design base theme implementation notes'
  created:
    -
      value: 1626967869
  promote:
    -
      value: true
  sticky:
    -
      value: false
  revision_translation_affected:
    -
      value: true
  path:
    -
      alias: ''
      langcode: en
  content_translation_source:
    -
      value: und
  content_translation_outdated:
    -
      value: false
  body:
    -
      value: "<p>OCHA<a href=\"https://github.com/UN-OCHA/common_design/\">common_design</a> is a Drupal 8 base theme, with a component library.</p>\r\n\r\n<p>A <a href=\"https://github.com/UN-OCHA/common_design/tree/main/common_design_subtheme\">sub theme </a> is available for implementations.</p>\r\n\r\n<p>Prod Demo site: <a href=\"https://web.brand.unocha.org\">https://web.brand.unocha.org</a></p>\r\n\r\n<p>Dev Demo site: <a href=\"https://demo.commondesign-unocha-org.ahconu.org/\">https://demo.commondesign-unocha-org.ahconu.org/</a></p>\r\n\r\n<p><strong>Table of Contents</strong></p>\r\n\r\n<ol>\r\n\t<li><a href=\"#base-theme\">Base theme</a></li>\r\n\t<li><a href=\"#sub-theme\">Sub theme</a></li>\r\n\t<li><a href=\"#jquery\">No dependency on jQuery</a></li>\r\n</ol>\r\n\r\n<h2>Implementation</h2>\r\n\r\n<h3 id=\"base-theme\">Base theme</h3>\r\n\r\n<p>Using composer, a <a href=\"https://github.com/UN-OCHA/common-design-site/blob/develop/composer.json#L120\">tagged release</a> of the <a href=\"https://github.com/UN-OCHA/common_design\">base theme</a> can be added to /themes/contrib. The version can be updated as needed to avail of improvements to the base theme. See its <a href=\"https://github.com/UN-OCHA/common_design/blob/main/README.md\">README</a> for details.</p>\r\n\r\n<h3 id=\"sub-theme\">Sub theme</h3>\r\n\r\n<p>There is a <a href=\"https://github.com/UN-OCHA/common_design/tree/main/common_design_subtheme\">sub theme repo</a> as a starting point for implementations. See its <a href=\"https://github.com/UN-OCHA/common_design/blob/main/common_design_subtheme/README.md\">README</a> for more info. All customisations should happen there. Overriding templates and using twig `extend` and `include` should provide a basic consistency for the Common header and footer. This is Drupal-specific and remains similar to D7 ocha_basic in site building approach (using Drupal regions and system menu blocks)</p>\r\n\r\n<h3 id=\"jquery\">No dependency on jQuery</h3>\r\n\r\n<p>We have dropped the dependency on jQuery and thus dropped the Bootstrap dropdown plugin. We have replaced the Bootstrap dropdown plugin with a <a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-dropdown.js\">custom JS</a> solution.</p>\r\n\r\n<h3>Javascript cd-dropdown component</h3>\r\n\r\n<p><a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-dropdown.js\">cd-dropdown</a> component is the vanilla JS replacement for Bootstrap’s dropdown plugin (used in ocha_basic Drupal 7 and jquery-dependent). It serves the same purpose and the behaviour from the end-user perspective is the same, but there are some notable differences in implementation.</p>\r\n\r\n<p>The bootstrap plugin used classes on the parent element, and accompanying CSS rules to hide and show both the toggle button and the dropdown element as needed, which meant both elements were present in the markup at all times. Now, we <strong>use javascript to create and remove the toggle button</strong> as needed and no classes are added to the parent element. We use the <a href=\"https://github.com/UN-OCHA/common_design/blob/master/sass/cd/cd-header/_cd-dropdowns.scss#L8\">attribute data-cd-hidden to apply the display rules</a>.</p>\r\n\r\n<h4>Behaviour</h4>\r\n\r\n<p><a href=\"https://github.com/UN-OCHA/common_design/blob/master/js/cd-dropdown.js#L175\">All elements with the data-cd-toggable</a> will be turned into a dropdown element and have a toggler button created, as a sibling element. The toggable element needs to be encapsulated as we rely on the previous sibling being the toggler button.</p>\r\n\r\n<p>There is a <a href=\"https://github.com/UN-OCHA/common_design/blob/main/common_design.theme#L330\">script attached to the head to detect if javascript is enabled</a>. This is to compensate for a similar detection from Drupal.js (adds .js class to the html element) which happens too late to prevent the flash of content as the dropdowns display on load and then are hidden.</p>\r\n\r\n<p>There are two elements: the button (referred to in code as “toggler”) and the dropdown (referred to as “element”). The dropdown element needs to be included in the markup and requires the attribute of `data-cd-toggable`.</p>\r\n\r\n<p>When one dropdown element is <a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-dropdown.js#L147\">expanded while another is open</a> and/or when the area outside the dropdown is clicked, all other <a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-dropdown.js#L59\">dropdowns will collapse</a>, unless a specific element is an exception or has `data-cd-toggable-keep` attribute. When the <a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-dropdown.js#L59\">ESC key is pressed</a>, the dropdown element is collapsed and focus is returned to its toggler button.</p>\r\n\r\n<p><a href=\"https://github.com/UN-OCHA/common_design/blob/main/templates/cd/cd-header/cd-ocha.html.twig#L7\">OCHA Services</a> and <a href=\"https://github.com/UN-OCHA/common_design/blob/main/templates/block/block--system-menu-block--main.html.twig#L46\">the main menu template override</a> provide good examples. All elements with `data-cd-toggable` attribute will be processed as dropdown elements, and toggler buttons will be created via setToggable, unsetToggable and updateToggable functions.</p>\r\n\r\n<p>Additional attributes should be added to the dropdown element markup for the button icons and to create BEM classes for styling purposes. This is self-explanatory in the <a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-dropdown.js#L213\">createButton function</a>. Note also the <a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-dropdown.js#L259\">data-cd-toggable-keep</a> and <a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-dropdown.js#L263\">data-cd-label-switch</a> attributes to extend the default dropdown behaviour.</p>\r\n\r\n<h4>Minimum requirements</h4>\r\n\r\n<p>The following attributes should be added to the dropdown element’s markup:</p>\r\n\r\n<ol>\r\n\t<li>`data-cd-toggable` - the value is used for the Button label</li>\r\n\t<li>`id` - this is also used to set the aria-controls attribute on the toggler</li>\r\n\t<li>`aria-labelledby` - The value should correspond to the ID of a heading attribute eg. <a href=\"https://github.com/UN-OCHA/common_design/blob/main/templates/cd/cd-header/cd-ocha.html.twig#L5\">OCHA Services</a> `&lt;h2 id=\"cd-ocha-services-title\"&gt;` and `&lt;div aria-labelledby=\"cd-ocha-services-title\"...&gt;`&nbsp;</li>\r\n\t<li>`data-cd-component` - the component name, for namespaced BEM selectors (eg. cd-filters)</li>\r\n</ol>\r\n\r\n<h4>Optional</h4>\r\n\r\n<ol start=\"5\">\r\n\t<li>`data-cd-logo` and/or `data-cd-icon` if either are required for the button</li>\r\n\t<li>`data-cd-logo-only` adds a class visually-hidden to the button label</li>\r\n\t<li>`data-cd-label-switch` for different labels depending on open/closed state</li>\r\n\t<li>`data-cd-focus-target` for adding focus to a specific element when dropdown is toggled (this works well with the Search component. Add the ID of the search input field and it will have focus when the dropdown is expanded)</li>\r\n\t<li>`data-cd-replace=”ID”` will replace the element with the given ID with a toggler. The element (eg: a link) serves as a fallback element for progressive enhancement when the cd-dropdown script cannot run.</li>\r\n</ol>\r\n\r\n<h4>Dropdowns on based on viewport dimensions</h4>\r\n\r\n<p>We <a href=\"https://github.com/UN-OCHA/common_design/blob/0a444dc6eedf38ec9456f34d1810ecbd75bd3d14/js/cd-dropdown.js#L174\">listen to the resize event</a> to register changes on the window object, and this enables us to create the toggler based on viewport dimensions. We use a <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties\">CSS custom property</a><a href=\"https://github.com/UN-OCHA/common_design/blob/main/sass/cd/cd-header/_cd-dropdowns.scss#L4\"> --dropdown and set its value to true as default</a>. For scenarios where the toggler should only be created on mobile (eg. Main menu) we set <a href=\"https://github.com/UN-OCHA/common_design/blob/main/sass/cd/cd-header/_cd-nav.scss#L152\">the --dropdown value to false at the desired breakpoint</a>. A <a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-dropdown.js#L379\">condition in updateToggable</a> verifies the value of the CSS custom property and runs either setToggable or unsetToggable as appropriate.</p>\r\n\r\n<p>For background on this technique, refer to <a href=\"https://justmarkup.com/articles/2017-01-24-handling-states-on-resize-using-css-custom-properties\">https://justmarkup.com/articles/2017-01-24-handling-states-on-resize-using-css-custom-properties</a></p>\r\n\r\n<p>Since CSS custom properties are not supported in IE11, <a href=\"https://github.com/UN-OCHA/common_design/blob/main/sass/cd/cd-header/_cd-nav.scss#L163\">we’ve needed to compensate with some additional display rules</a>. These are wrapped in a media query that only IE11 will pick up and in time can be removed completely.</p>\r\n\r\n<h4>Drupal Menus and dropdown</h4>\r\n\r\n<p>We have added a <a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-dropdown.js#L413\">separate function to deal with Drupal nested menus</a> (Main menu is a good example). The function provides a default selector which we can change in <a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-menu.js#L4\">an override javascript file</a> if needed. This prevents the need to change the Drupal menu markup to suit the javascript code.</p>\r\n\r\n<h3>Component library</h3>\r\n\r\n<p>A variety of components in the <a href=\"https://github.com/UN-OCHA/common_design/tree/main/components\">Component library</a> can cater for some generic or widely used content elements. The implementation of these will depend on context.</p>\r\n\r\n<p>The Component library consists of individual components, made up of markup (.html), CSS, JS (sometimes) and a Drupal implementation (.html.twig) to <a href=\"https://demo.commondesign-unocha-org.ahconu.org/demo\">display the component on the demo site</a>. This requires <a href=\"https://www.drupal.org/project/components\">Drupal Components module</a>.</p>\r\n\r\n<p>The component library can inform design and development decisions, and can demonstrate how elements work in specific contexts and in relation to each other, as well as their individual behaviour.</p>\r\n\r\n<p>We encourage simple, performant, accessible and shareable design patterns.</p>\r\n\r\n<h3>Namespacing</h3>\r\n\r\n<ol>\r\n\t<li>Twig namespacing is provided by Drupal and extended using the <a href=\"https://www.drupal.org/project/components\">Components module</a></li>\r\n\t<li><a href=\"https://github.com/UN-OCHA/common_design/blob/main/js/cd-dropdown.js#L215\">Data attribute prefixes</a>. The custom javascript for dropdown behaviour uses `data-cd-[attribute]` to prevent conflicts with 3rd party libraries.</li>\r\n\t<li>BEM with the cd-[component-name] convention for selectors.</li>\r\n\t<li>SVG icons with <a href=\"https://github.com/UN-OCHA/common_design#icons\">cd- prefix</a></li>\r\n</ol>\r\n\r\n<h3>Performance and Support</h3>\r\n\r\n<p>Drupal libraries can attach to templates so only loaded when the template is *Note the caching issue here</p>\r\n\r\n<p>See <a href=\"https://docs.google.com/document/d/1lN0kLOkgfEAmdGODZ0PzLxiAr0Z-87C4ytet6F4GIuw/edit#\">Browsers to test</a> and <a href=\"https://docs.google.com/document/d/1AjKtlwUuJhZpbSrPs-nku3ECnMyZ67m9A1Lh05w7xM4/edit#heading=h.vtkyb240lbbr\">Supporting a global audience</a> doc for our current commitments</p>\r\n\r\n<p>Use `@supports` Feature queries with basic one column layout as default. Attention to displaying readable content as a priority as noted in the docs above.</p>\r\n\r\n<h3>Variables</h3>\r\n\r\n<p>For the <a href=\"https://github.com/UN-OCHA/common_design/tree/main/sass/cd\">Common Design Header and Footer styles</a>, we use SASS and dart-sass to compile to CSS.</p>\r\n\r\n<p>Custom components can be CSS or SASS. We currently use <a href=\"https://github.com/UN-OCHA/common_design/blob/main/sass/cd/_cd-variables.scss#L22\">CSS custom properties to define colours</a> in CSS components (IE11 does not support so attention to fallback colours is important)</p>\r\n\r\n<h3>BEM&nbsp;</h3>\r\n\r\n<p>See <a href=\"https://www.drupal.org/docs/develop/standards/css/css-architecture-for-drupal-8\">Drupal Best practices</a> for background</p>\r\n\r\n<h3>Task management</h3>\r\n\r\n<p>NPM scripts are described in <a href=\"https://github.com/UN-OCHA/common_design#task-management\">common_design README</a></p>\r\n\r\n<h3>Variants and Drupal-specific components</h3>\r\n\r\n<ol>\r\n\t<li>Language switcher</li>\r\n</ol>\r\n\r\n<h3>Authenticated user UX</h3>\r\n\r\n<p>Most implementations will use the <a href=\"https://www.drupal.org/project/social_auth_hid\">Social Auth Humanitarian ID module</a>. This module has an option to redirect the HID login, and disable Drupal default log in forms.</p>\r\n\r\n<p>When there are additional menu items, or menus, or widgets in the global header area, see <a href=\"https://docs.google.com/document/d/1nKZs8LMDwBKDRECdrEDdWp-47saRpCsUO7tLQsOXAXY/edit#\">CD user login and user actions</a> doc for configuration (Drupal-specific) and design criteria (generic)<br />\r\n&nbsp;</p>\r\n\r\n<h3>Packagist</h3>\r\n\r\n<p>We can include common_design base theme in sites that use composer using `<strong>composer require unocha/common_design`</strong> and optionally set release versions</p>\r\n\r\n<p><a href=\"https://packagist.org/packages/unocha/common_design\">https://packagist.org/packages/unocha/common_design</a></p>\r\n\r\n<h3>Local set up</h3>\r\n\r\n<p>Basic <a href=\"https://github.com/UN-OCHA/common-design-site/tree/develop/.docksal\">docksal config</a> is included in the repo for local set up or <a href=\"https://github.com/UN-OCHA/common-design-stack/blob/main/env/feature/local/README.md\">docker stack set up</a> with a local reverse proxy.</p>\r\n\r\n<p>Snapshots: <a href=\"https://snapshots.aws.ahconu.org/commondesign/demo\">https://snapshots.aws.ahconu.org/commondesign/demo</a></p>\r\n\r\n<h3>Deployment</h3>\r\n\r\n<p>We can <a href=\"https://github.com/UN-OCHA/common-design-site/blob/develop/composer.json#L120\">bump the version on the common-design-site composer.json</a> `<strong>composer update unocha/common_design`</strong> and regenerate the composer.lock in a new PR that we merge to <a href=\"https://github.com/UN-OCHA/common-design-site/\">common-design-site develop</a> branch.</p>\r\n\r\n<p>To deploy a new version of the common_design base theme to either CD Prod, Feature or Demo sites, a <a href=\"https://github.com/UN-OCHA/common_design/releases\">release of the base theme</a> or a <a href=\"https://github.com/UN-OCHA/common-design-site/blame/87d19e7e0c76a59ac449a35b4ca115ab83892324/composer.json#L120\">feature branch</a> can be created.</p>\r\n\r\n<p><a href=\"https://jenkins.aws.ahconu.org/view/Digital%20Services/job/ds-commondesign-demo-deploy/\">Deployments to the demo site</a> are automatically triggered when the develop branch of<a href=\"https://github.com/UN-OCHA/common-design-site\"> common-design-site</a> is updated.</p>\r\n\r\n<h3>Testing</h3>\r\n\r\n<p>See <a href=\"https://github.com/UN-OCHA/common_design/blob/main/README.md#e2e-testing\">README</a> for e2e tests.</p>\r\n\r\n<p>There is a <a href=\"https://jenkins.aws.ahconu.org/view/Digital%20Services/job/ds-vrt/\">Jenkins job</a> using <a href=\"https://github.com/UN-OCHA/ocha_vrt\">ocha_vrt</a> for VRTs</p>\r\n\r\n<h3>Versioning</h3>\r\n\r\n<p>Refer to <a href=\"https://github.com/UN-OCHA/common_design#releases\">Releases</a> in common_design README</p>\r\n\r\n<h3>Print Styles</h3>\r\n\r\n<p>Using `@media print` should be sufficient in most cases, unless there is a specific reason to have a specific print.css stylesheet (eg. used by a PDF generation tool). Refer to <a href=\"https://github.com/UN-OCHA/common_design/blob/main/sass/cd/_cd-print.scss\">_print.scss</a> for basic rules</p>\r\n\r\n<h2>Drupal theme implementation and site build</h2>\r\n\r\n<p>Refer to <a href=\"https://docs.google.com/document/d/1LgxLFlE8a2OgMdh6hk3dhf434oQJ_OXqURnvotrQ9TQ/edit#\">Common Design checklist</a> for guidance.</p>\r\n\r\n<ol>\r\n\t<li>Template overrides are preferred over preprocess functions to manipulate markup. However, for complicated markup like the search form it’s hard to avoid preprocess functions.</li>\r\n\t<li>Main menu should be placed in `header navigation` region\r\n\t<ol>\r\n\t\t<li>Maximum 2 levels only, if dropdown menus are needed.</li>\r\n\t\t<li>Main menu parent items should be set to ‘Show as expanded’<br />\r\n\t\tThere is a max number of top-level items before layout breaks (search and menu gets pushed below logo, although still usable)</li>\r\n\t</ol>\r\n\t</li>\r\n\t<li>Search block needs to be placed in `header search` region</li>\r\n\t<li>Site branding block needs to be placed in `header logo` region</li>\r\n\t<li>User menu block needs to be placed `header top` region. Additional blocks can also be placed here, like the language switcher or another menu</li>\r\n\t<li>Footer menu block needs to be placed in `Footer navigation` region</li>\r\n\t<li>Social media links can be overridden in the <a href=\"https://github.com/UN-OCHA/common_design/blob/main/common_design_subtheme/templates/cd/cd-footer/cd-footer.html.twig\">sub theme template</a></li>\r\n\t<li>Copyright/disclaimer and CC logo is hardcoded</li>\r\n\t<li>Ocha Services is hardcoded and the first column can be <a href=\"https://github.com/UN-OCHA/common_design/blob/main/common_design_subtheme/templates/cd/cd-header/cd-ocha.html.twig\">overridden in the sub theme template</a>.<br />\r\n\tSee <a href=\"https://humanitarian.atlassian.net/browse/CD-97\">Inclusion and order of items arrived at by analytics and alphabetical</a> for history.</li>\r\n</ol>\r\n"
      format: full_html
      summary: ''
  field_hero_component:
    -
      entity:
        _meta:
          version: '1.0'
          entity_type: paragraph
          uuid: 5f634ee3-cd92-4107-874c-068f96812410
          bundle: hero
          default_langcode: en
        default:
          status:
            -
              value: true
          created:
            -
              value: 1626968392
          behavior_settings:
            -
              value: {  }
          revision_translation_affected:
            -
              value: true
